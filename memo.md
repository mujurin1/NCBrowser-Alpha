# 問題と対策

## コメント受信時（問題）
１つコメントが来るたびに、非同期でそのコメントを解釈し、状態を変更する必要がある\
が、コメントが来たらまず表示したい。\
表示した後に、コメントを解釈して、状態変更し、新しい状態を元に、再描画する。
1. コメントが来た
2. 同期で素早く行える処理のみ行う
3. コメントを表示１回目（読み上げはここで）
4. コメント内容を元に色々する（非同期）
5. 色々した結果を状態に反映
6. 新しい状態を元に再度表示２回目

## コメント受信時（解法）
一定間隔毎にバッチ処理を実行する\
**コメント受信**
1. コメントが来た
2. 同期で素早く行える処理のみ行う
3. コメント表示
4. バッチにコメントを追加

**バッチ処理**
1. 溜まったコメントを纏めて処理
2. 状態の更新

# 設計段階で意識すること
* 表示速度・スクロール時の表示速度
* NCV準拠（NCVにある大体の機能や使い勝手はNCVに寄せる・参考にする）
* 



# その他メモ

## 一部の情報はローカルストレージで管理
ユーザーの情報やビューアの状態などは、\
`chrome.storage.local`で管理する。\
これの読み書きは非同期

コメントが来るたびにこのストレージが変化する可能性がある


